<%- include('_layouts/header') %>

  <link rel="stylesheet" href="/css/cart.css">

  <% if (typeof cart !=="undefined" && cart.length> 0) { %>
    <div class="container mt-4">
      <h1 class="text-center mb-4">ðŸ›’ My Cart</h1>

      <table class="table table-striped text-center align-middle">
        <thead class="table-dark">
          <tr>
            <th>Title</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Actions</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <% let total=0; %>
            <% cart.forEach(product=> { %>
              <% let sub=parseFloat(product.qt * product.price).toFixed(2); %>
                <% total +=+sub; %>
                  <tr>
                    <!-- <td><%= product.title %></td>
            <td>â‚¹ <%= parseFloat(product.price).toFixed(2) %></td>
            <td><%= product.qt %></td> -->
                    <td data-label="Title">
                      <%= product.title %>
                    </td>
                    <td data-label="Price">â‚¹ <%= parseFloat(product.price).toFixed(2) %>
                    </td>
                    <td data-label="Quantity">
                      <%= product.qt %>
                    </td>
                    <td data-label="Actions">
                      <a class="btn btn-sm btn-outline-primary"
                        href="/cart/update/<%= product.title %>?action=add">+</a>
                      <a class="btn btn-sm btn-outline-secondary"
                        href="/cart/update/<%= product.title %>?action=remove">âˆ’</a>
                      <a class="btn btn-sm btn-outline-danger"
                        href="/cart/update/<%= product.title %>?action=clear">Clear</a>
                    </td>
                    <td data-label="Subtotal">â‚¹ <%= sub %>
                    </td>
                  </tr>
                  <% }) %>
                    <tr class="fw-bold">
                      <td colspan="4" class="text-end">Total:</td>
                      <td>â‚¹ <%= parseFloat(total).toFixed(2) %>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="5" class="text-end">
                        <a class="btn btn-danger me-2 clearcart" href="/cart/clear">Clear Cart</a>
                        <!-- <a class="btn btn-success buynow" href="/cart/buy">Buy Now</a> -->
                        <form id="cartBuyForm" action="/cart/buynow" method="POST">
                          <button class="btn btn-success">Buy Now</button>
                        </form>
                      </td>
                    </tr>
        </tbody>
      </table>
    </div>
    <% } else { %>
      <div class="container text-center mt-5">
        <h3>Your cart is empty</h3>
        <a class="btn btn-outline-primary mt-3" href="/products">Browse Products</a>
      </div>
      <% } %>

        <script>

          document.getElementById("cartBuyForm").addEventListener("submit", function (e) {
            const confirmOrder = confirm("Are you sure you want to place this order? Once placed, it cannot be undone.\nOur team will contact you for address and payment.");
            if (!confirmOrder) {
              e.preventDefault(); // Cancel submission
            }
          });



          $(function () {
            $('a.clearcart').on('click', function () {
              return confirm('Clear Cart?');
            });

            $('a.buynow').on('click', function (e) {
              e.preventDefault();
              window.location.href = '/cart/buy';
            });
          });
        </script>

        <%- include('_layouts/footer') %>

          <style>
            body {
              background-color: #f9f9f9;
              font-family: 'Poppins', sans-serif;
            }

            .container h1 {
              font-weight: 600;
              color: #333;
              font-size: 2.2rem;
            }

            .table {
              background-color: white;
              border-radius: 10px;
              overflow: hidden;
              box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            }

            .table th {
              background-color: #343a40;
              color: #fff;
              font-weight: 500;
            }

            .table td {
              vertical-align: middle;
            }

            .table td,
            .table th {
              padding: 1rem;
            }

            .btn {
              font-size: 0.875rem;
              padding: 0.4rem 0.75rem;
            }

            .btn-outline-primary {
              border-color: #007bff;
              color: #007bff;
            }

            .btn-outline-primary:hover {
              background-color: #007bff;
              color: white;
            }

            .btn-outline-secondary:hover {
              background-color: #6c757d;
              color: white;
            }

            .btn-outline-danger:hover {
              background-color: #dc3545;
              color: white;
            }

            .btn-success {
              background-color: #28a745;
              border-color: #28a745;
            }

            .btn-success:hover {
              background-color: #218838;
            }

            .table-striped tbody tr:nth-of-type(odd) {
              background-color: #f2f2f2;
            }

            .text-end {
              text-align: right;
            }

            /* Responsive tweaks */
            @media (max-width: 768px) {
              .table thead {
                display: none;
              }

              .table,
              .table tbody,
              .table tr,
              .table td {
                display: block;
                width: 100%;
              }

              .table tr {
                margin-bottom: 1rem;
                border-bottom: 2px solid #ddd;
              }

              .table td {
                text-align: right;
                padding-left: 50%;
                position: relative;
              }

              .table td::before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 50%;
                padding-left: 1rem;
                font-weight: 600;
                text-align: left;
              }

              .table td:last-child {
                border-bottom: none;
              }
            }

            /* Primary Button */
            .btn-primary,
            .btn-outline-primary {
              border-radius: 30px;
              font-weight: 500;
              transition: all 0.3s ease;
            }

            /* Success Button */
            .btn-success {
              background: linear-gradient(135deg, #28a745, #218838);
              border: none;
              border-radius: 30px;
              font-weight: 600;
              padding: 0.5rem 1.2rem;
              box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2);
              transition: all 0.3s ease;
            }

            .btn-success:hover {
              background: #1e7e34;
              box-shadow: 0 6px 15px rgba(40, 167, 69, 0.3);
              transform: translateY(-1px);
            }

            /* Danger (Clear) Button */
            .btn-danger,
            .btn-outline-danger {
              border-radius: 30px;
              font-weight: 500;
              background: transparent;
              color: #dc3545;
              border: 2px solid #dc3545;
              transition: all 0.3s ease;
            }

            .btn-danger:hover {
              background-color: #dc3545;
              color: white;
              transform: translateY(-1px);
              box-shadow: 0 5px 15px rgba(220, 53, 69, 0.2);
            }

            /* Quantity Control Buttons */
            .btn-outline-primary,
            .btn-outline-secondary {
              border-radius: 50px;
              padding: 0.3rem 0.8rem;
              font-size: 0.9rem;
              font-weight: 500;
            }

            .btn-outline-primary:hover {
              background-color: #007bff;
              color: white;
              transform: scale(1.05);
            }

            .btn-outline-secondary:hover {
              background-color: #6c757d;
              color: white;
              transform: scale(1.05);
            }

            /* Hover transition for all buttons */
            .btn {
              transition: all 0.2s ease-in-out;
            }
          </style>