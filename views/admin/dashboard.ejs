<%- include('../_layouts/header') %>

<link rel="stylesheet" href="/css/admin_dashboard.css">
<div class="container">
  <h1 class="mb-4">Admin Dashboard</h1>

  <div class="stats">
    <div class="card">
      <h4>Total Registered Users</h4>
      <p><%= userCount %></p>
    </div>
    <div class="card">
      <h4>Total Products</h4>
      <p><%= productCount %></p>
    </div>
  </div>

  <h2 class="mt-5">Product Management</h2>
  <a href="/admin/products/add-product" class="btn btn-success mb-3">Add New Product</a>

  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Price</th>
          <th>Size (ml)</th>
          <th class="text-center">Stock Quantity</th>
          <th>In Stock</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(function(product) { %>
          <tr>
            <td data-label="Title"><%= product.title %></td>
            <td data-label="Category"><%= product.category %></td>
            <td data-label="Price">₹<%= product.price.toFixed(2) %></td>
            <td data-label="Size (ml)"><%= product.size %> ml</td>
            <td data-label="Stock Quantity" class="text-center"><%= product.tt %></td>
            <td data-label="In Stock"><%= product.inStock ? 'Yes' : 'No' %></td>
            <td data-label="Actions">
              <a href="/admin/products/edit-product/<%= product._id %>" class="btn btn-sm btn-primary">Edit</a>
              <a href="/admin/products/delete-product/<%= product._id %>" class="btn btn-sm btn-danger">Delete</a>
              <form action="/admin/products/toggle-stock/<%= product._id %>" method="POST" style="display:inline;">
                <button class="btn btn-sm btn-warning" type="submit">
                  Mark as <%= product.inStock ? 'Out of Stock' : 'In Stock' %>
                </button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <h2 class="mt-5">Orders</h2>
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>User</th>
          <th>Mobile</th>
          <th>Total</th>
          <th>Order Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% orders.forEach(order => { %>
          <tr>
            <td data-label="User"><%= order.user.name %></td>
            <td data-label="Mobile"><%= order.user.mobile || 'N/A' %></td>
            <td data-label="Total">₹<%= order.totalAmount %></td>
            <td data-label="Order Date"><%= order.createdAt.toLocaleDateString('en-IN') %></td>
            <td data-label="Actions">
              <a href="/admin/user-orders/<%= order.user._id %>" class="btn btn-sm btn-info">View All</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<%- include('../_layouts/footer') %>